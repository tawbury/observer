# Observer System Alerting Rules
# This file contains alerting rules for monitoring the Observer system

groups:
  - name: observer_system_alerts
    interval: 30s
    rules:

      - alert: HighAPIErrorRate
        expr: (rate(observer_api_errors_total[5m]) / rate(observer_api_requests_total[5m])) > 0.05
        for: 5m
        labels:
          severity: critical
          service: observer
        annotations:
          summary: HighAPIErrorRate triggered
          description: API error rate exceeds 5%

      - alert: SystemDowntime
        expr: observer_system_uptime_seconds < 60
        for: 2m
        labels:
          severity: critical
          service: observer
        annotations:
          summary: SystemDowntime triggered
          description: System has been running for less than 1 minute

      - alert: UniverseSizeAnomaly
        expr: abs(observer_universe_size - avg_over_time(observer_universe_size[1h])) > avg_over_time(observer_universe_size[1h]) * 0.5
        for: 10m
        labels:
          severity: warning
          service: observer
        annotations:
          summary: UniverseSizeAnomaly triggered
          description: Universe size deviates significantly from average

      - alert: RapidUniverseExpansion
        expr: rate(observer_universe_created_total[5m]) > 100
        for: 5m
        labels:
          severity: warning
          service: observer
        annotations:
          summary: RapidUniverseExpansion triggered
          description: Universe expansion rate exceeds 100 symbols/sec

      - alert: APILatencyHigh
        expr: histogram_quantile(0.99, rate(observer_api_request_duration_seconds_bucket[5m])) > 2.0
        for: 10m
        labels:
          severity: warning
          service: observer
        annotations:
          summary: APILatencyHigh triggered
          description: API request p99 latency exceeds 2 seconds

      - alert: APIUnresponsive
        expr: rate(observer_api_requests_total[5m]) < 1
        for: 5m
        labels:
          severity: critical
          service: observer
        annotations:
          summary: APIUnresponsive triggered
          description: API requests dropped below 1 per second

      - alert: APICatastrophicErrors
        expr: (rate(observer_api_errors_total[1m]) / rate(observer_api_requests_total[1m])) > 0.5
        for: 2m
        labels:
          severity: critical
          service: observer
        annotations:
          summary: APICatastrophicErrors triggered
          description: API error rate exceeds 50% (critical condition)
