# E2E Audit Part 2-C: Workflow Permission í•´ê²° ê°€ì´ë“œ

**ìƒì„± ì¼ì‹œ**: 2026-01-24 01:15 KST
**ìƒíƒœ**: ğŸ”§ ìˆ˜ì • í•„ìš”
**ë¸”ë¡œì»¤**: GHCR write_package ê¶Œí•œ ì˜¤ë¥˜

---

## ğŸ“‹ ë¬¸ì œ ìš”ì•½

íƒœê·¸ `20260124-011352` í‘¸ì‹œ í›„ E2E í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:
- âœ… build-push-tag.yml íŠ¸ë¦¬ê±° ì„±ê³µ
- âœ… ì´ë¯¸ì§€ ë¹Œë“œ ì„±ê³µ
- âŒ GHCR í‘¸ì‹œ ì‹¤íŒ¨: `permission_denied: write_package`

---

## ğŸ” ì›ì¸

GitHub Actionsì˜ `GITHUB_TOKEN`ì´ GHCRì— íŒ¨í‚¤ì§€ë¥¼ ì“¸ ê¶Œí•œì´ ì—†ìŒ.

**ì¦ê±°**:
```
ERROR: denied: permission_denied: write_package
pushing ghcr.io/tawbury/observer:20260124-011352 with docker
```

**ì›Œí¬í”Œë¡œìš° ì„¤ì • (ì •ìƒ)**:
```yaml
# .github/workflows/build-push-tag.yml
permissions:
  contents: read
  packages: write  # â† ì„¤ì •ì€ ìˆì§€ë§Œ ì ìš© ì•ˆ ë¨
```

---

## âœ… í•´ê²° ë°©ë²• 1: Repository Workflow Permissions í™œì„±í™”

### ë‹¨ê³„ 1: GitHub ì„¤ì • í™•ì¸

1. ë¸Œë¼ìš°ì €ì—ì„œ ì´ë™:
   ```
   https://github.com/tawbury/observer/settings/actions
   ```

2. "Workflow permissions" ì„¹ì…˜ì—ì„œ í˜„ì¬ ì„¤ì • í™•ì¸:
   - âŒ "Read repository contents and packages permissions" (ì½ê¸° ì „ìš©)
   - âœ… "Read and write permissions" (ì½ê¸°/ì“°ê¸°) â† ì´ê²ƒìœ¼ë¡œ ë³€ê²½

3. ë³€ê²½ í›„ "Save" í´ë¦­

### ë‹¨ê³„ 2: ì¬í…ŒìŠ¤íŠ¸

```bash
# ìƒˆ íƒœê·¸ ìƒì„±
TAG=$(date -u +"%Y%m%d-%H%M%S")
git tag $TAG
git push origin $TAG

# GitHub Actions í™•ì¸
# https://github.com/tawbury/observer/actions
```

---

## âœ… í•´ê²° ë°©ë²• 2: GHCR íŒ¨í‚¤ì§€ ì ‘ê·¼ ê¶Œí•œ í™•ì¸

### ë‹¨ê³„ 1: íŒ¨í‚¤ì§€ ì„¤ì • í™•ì¸

1. ë¸Œë¼ìš°ì €ì—ì„œ ì´ë™:
   ```
   https://github.com/tawbury?tab=packages
   ```

2. `observer` íŒ¨í‚¤ì§€ í´ë¦­

3. "Package settings" í´ë¦­

4. "Manage Actions access" ì„¹ì…˜ì—ì„œ í™•ì¸:
   - `tawbury/observer` ë¦¬í¬ì§€í† ë¦¬ê°€ "Write" ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸
   - ì—†ìœ¼ë©´ "Add repository" â†’ `tawbury/observer` â†’ "Write" ì„ íƒ

### ë‹¨ê³„ 2: ë¦¬í¬ì§€í† ë¦¬ ì—°ê²°

íŒ¨í‚¤ì§€ê°€ ë¦¬í¬ì§€í† ë¦¬ì™€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´:

1. "Package settings" â†’ "Danger zone"
2. "Change package visibility" ë˜ëŠ” "Delete package" (í•„ìš” ì‹œ)
3. ë˜ëŠ” "Connect repository" â†’ `tawbury/observer` ì„ íƒ

---

## âœ… í•´ê²° ë°©ë²• 3: PAT(Personal Access Token) ì‚¬ìš© (ëŒ€ì•ˆ)

GitHub Token ëŒ€ì‹  PATë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•:

### ë‹¨ê³„ 1: PAT ìƒì„±

1. https://github.com/settings/tokens/new
2. "Generate new token (classic)" í´ë¦­
3. ê¶Œí•œ ì„ íƒ:
   - âœ… `write:packages`
   - âœ… `read:packages`
   - âœ… `delete:packages` (ì„ íƒì‚¬í•­)
4. "Generate token" í´ë¦­
5. í† í° ë³µì‚¬

### ë‹¨ê³„ 2: GitHub Secrets ì¶”ê°€

1. https://github.com/tawbury/observer/settings/secrets/actions
2. "New repository secret" í´ë¦­
3. Name: `GHCR_TOKEN`
4. Value: (ë³µì‚¬í•œ PAT)
5. "Add secret" í´ë¦­

### ë‹¨ê³„ 3: ì›Œí¬í”Œë¡œìš° ìˆ˜ì •

```yaml
# .github/workflows/build-push-tag.yml
- name: Login to GHCR
  uses: docker/login-action@v3
  with:
    registry: ghcr.io
    username: ${{ github.actor }}
    password: ${{ secrets.GHCR_TOKEN }}  # â† GITHUB_TOKEN ëŒ€ì‹  PAT ì‚¬ìš©
```

---

## ğŸ“Š ê¶Œì¥ ìˆœì„œ

1. **ìš°ì„  ì‹œë„**: ë°©ì•ˆ 1 (Workflow Permissions í™œì„±í™”)
   - ê°€ì¥ ê°„ë‹¨í•˜ê³  í‘œì¤€ì ì¸ ë°©ë²•
   - ì¶”ê°€ í† í° ê´€ë¦¬ ë¶ˆí•„ìš”

2. **2ì°¨ ì‹œë„**: ë°©ì•ˆ 2 (GHCR íŒ¨í‚¤ì§€ ê¶Œí•œ í™•ì¸)
   - íŒ¨í‚¤ì§€ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°

3. **ìµœì¢… ëŒ€ì•ˆ**: ë°©ì•ˆ 3 (PAT ì‚¬ìš©)
   - ìœ„ ë°©ë²•ë“¤ì´ ì‹¤íŒ¨í•œ ê²½ìš°
   - ë” ê°•ë ¥í•œ ê¶Œí•œ í•„ìš”

---

## ğŸ”— ì°¸ê³  ë¬¸ì„œ

- [GitHub Actions Permissions](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token)
- [GHCR Authentication](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-with-a-personal-access-token-classic)
- [Managing Actions Permissions](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository)

---

## â¸ï¸ ë‹¤ìŒ ë‹¨ê³„

1. GitHub ì›¹ UIì—ì„œ Workflow permissions í™•ì¸ ë° ìˆ˜ì •
2. ì„¤ì • ë³€ê²½ í›„ ìƒˆ íƒœê·¸ë¡œ ì¬í…ŒìŠ¤íŠ¸
3. ì„±ê³µ ì‹œ E2E Audit Part 2-Dë¡œ ì§„í–‰

---

**ë³´ê³ ì„œ ë**

*Generated by E2E Audit System - Part 2-C (Workflow Permission Fix)*
